<html lang="en">
  <head>
    <title>kamon | Annotation | Documentation</title>

<meta charset="utf-8">
<meta name="viewport"    content="width=device-width, initial-scale=1.0">
<meta name="description" content="Kamon is a set of tools that will help you monitor your reactive applications">

<!--<link rel="stylesheet" href="/assets/css/syntax-highlight.css">-->
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="/assets/css/prism.css">
<link rel="stylesheet" href="/assets/css/styles.css">
<link rel="stylesheet" href="/assets/css/kamon.css">


<link rel="shortcut icon" href="/assets/img/favicon.ico" type="image/x-icon">
<link rel="icon" href="/assets/img/favicon.ico" type="image/x-icon">
<link href="https://plus.google.com/107736741680270898032?rel=author">
<link rel="alternate" type="application/rss+xml" title="Kamon Teamblog Feed" href="/teamblog/rss/">

<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

  </head>
  <body>
    <nav class="navbar navbar-default kamon-navbar">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-12 col-md-3">
          <a href="/documentation/get-started/">
            <img class="kamon-logo-image" alt="Kamon" src="/assets/img/kamon-logo-latest.svg">
          </a>
      </div>

      <div class="col-12 col-md-9">
        <div class="row justify-content-end align-items-center navigation-links">
            <div class="wip-warning col-12 col-md-4">
              WARNING: We are updating and fixing all docs around!
            </div>
            <a class="col-12 col-md-4 col-lg-3" href="/documentation/get-started/">
              <span class="nav-link">DOCUMENTATION</span>
            </a>
            <a class="col-12 col-md-2" href="/teamblog/">
              <span class="nav-link">BLOG</span>
            </a>
            
            <div class="col-12 col-md-2 hidden-sm-down">
              <div class="row justify-content-around align-items-center">
                <a href="https://twitter.com/kamonteam">
                  <i class="fa fa-twitter fa-lg nav-icon" aria-hidden="true"></i>
                </a>
                <a href="https://github.com/kamon-io/Kamon">
                  <i class="fa fa-github fa-lg nav-icon" aria-hidden="true"></i>
                </a>
                <a href="http://kamon.io/teamblog/rss/">
                  <i class="fa fa-rss fa-lg nav-icon" aria-hidden="true"></i>
                </a>
                <a href="https://groups.google.com/forum/#!forum/kamon-user">
                  <i class="fa fa-envelope fa-lg nav-icon" aria-hidden="true"></i>
                </a>
              </div>
            </div>
        </div>
      </div>
    </div>
  </div>
</nav>
      <div class="hero jumbotron-top">
    <div class="container">
      <div class="row">
        <div class="col-xs-12 col-md-7">
          <span class="jumbo-title">Documentation</span>
        </div>
      </div>
    </div>
  </div>  

    <div class="container">
      <div class="row">
        <div class="col-12 col-md-9 push-md-3">
          <div class="row align-items-center justify-content-end kamino-docs-top">
            <div>
                <a href="https://kamino.io">
                  <img class="img-fluid" alt="Sponsored by Kamino" src="/assets/img/sponsored-by-kamino.svg">
                </a>
            </div>
          </div>
          <div class="row docs-content">
            <div class="col-12">
              <h1 id="annotation-module">Annotation Module</h1>

<p>The Annotation module provides a set of annotations that allow you to easily integrate Kamon’s metrics and tracing
facilities with your application.</p>

<p class="alert alert-info">
The <b>kamon-annotation</b> module require you to start your application using the AspectJ Weaver Agent. Kamon will warn
you at startup if you failed to do so.
</p>

<h2 id="enabling-annotation-support">Enabling Annotation Support</h2>

<p>Besides starting your application with the AspectJ Weaver Agent, there are two additional steps required to use
annotations. First you must add the <code>@EnableKamon</code> annotation to the classes you would like to be scanned for any of the
provided annotations, otherwise the rest of the annotations described bellow wont be able to work at all.</p>

<p>All the provided annotations are in the <code>kamon.annotation</code> package. Enabling annotation support for a class looks as
simple as this:</p>

<div class="code-example"><ul class="nav nav-tabs language-tab justify-content-end" role="tablist"><li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#scala_0_803445" role="tab">Scala</a></li><li class="nav-item"><a class="nav-link" data-toggle="tab" href="#java_1_803445" role="tab">Java</a></li></ul><div class="tab-content"><div class="tab-pane active" id="scala_0_803445" role="tabpanel"><pre class="line-numbers language-scala"><code class="language-scala">@EnableKamon
@Controller
@RequestMapping(value = Array(&quot;/scala/orders&quot;))
class ScalaOrdersController {

    @Trace(&quot;ListOrders&quot;)
    @RequestMapping(method = Array(RequestMethod.GET))
    @ResponseBody
    def listOrders: String = {
        &quot;Listing all orders.&quot;
    }
}
</code></pre></div><div class="tab-pane" id="java_1_803445" role="tabpanel"><pre class="line-numbers language-java"><code class="language-java">@EnableKamon
@Controller
@RequestMapping(&quot;/java/orders&quot;)
public class JavaOrdersController {

    @Trace(&quot;ListOrders&quot;)
    @RequestMapping(method = RequestMethod.GET)
    public @ResponseBody String listOrders() {
        return &quot;Listing all orders.&quot;;
    }
}
</code></pre></div></div></div>

<p>In the example above, the controller classes are annotated with <code>@EnableKamon</code> to ensure that any method using Kamon
annotations, such as the <code>listOrders</code> method will work properly.</p>

<p>The second thing you need to do would be to add a minimal <code>aop.xml</code> file that will tell the AspectJ Weaver to actually scan your
project classes to apply annotations to it. Your file might look like this:</p>

<div class="code-example"><ul class="nav nav-tabs language-tab justify-content-end" role="tablist"><li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#markup_0_830600" role="tab">aop.xml</a></li></ul><div class="tab-content"><div class="tab-pane active" id="markup_0_830600" role="tabpanel"><pre class="line-numbers language-markup"><code class="language-markup">&lt;!DOCTYPE aspectj PUBLIC &quot;-//AspectJ//DTD//EN&quot; &quot;http://www.eclipse.org/aspectj/dtd/aspectj.dtd&quot;&gt;

&lt;aspectj&gt;
    &lt;weaver options=&quot;-Xlint:ignore&quot;&gt;
        &lt;include within=&quot;kamon..*&quot;/&gt;
        &lt;exclude within=&quot;org.aspectj.*&quot;/&gt;
    &lt;/weaver&gt;
&lt;/aspectj&gt;
</code></pre></div></div></div>

<p>Try to keep the filters as specific as possible because all classes matching the provided include filters will be fully
scanned to detect if instrumentation should be applied. Having very broad filters (such as <code>**</code>) will significantly
increase the startup time as the AspectJ Weaver will have much more work to do on startup.</p>

<p>You might have recognized the other annotations available in the example as being part of the <a href="http://projects.spring.io/spring-framework/">Spring Framework</a>, and
they certainly are. As you might know, we love Scala, but we are aware that using annotations in the Scala world is not
a common practice, whereas in the Java world it is very common to describe and extend application functionality via
annotations, thus, all the examples provided in this section are based on a simple <a href="http://projects.spring.io/spring-boot/">Spring Boot</a> example application
with controllers created using both Java and Scala.</p>

<h2 id="manipulating-traces-and-segments">Manipulating Traces and Segments</h2>

<p>Delimiting traces and segments are one of the most basic tasks you would want to perform to start monitoring your
application using Kamon, and the <code>@Trace</code> and <code>@Segment</code> annotations allow you to do just that:</p>

<ul>
  <li><strong>@Trace</strong>: when a method is marked with this annotation a new <a href="/core/tracing/core-concepts/#the-tracecontext">Trace</a> will be started every time the method is called
and automatically finished once the method returns. Also, the generated <code>TraceContext</code> becomes the current context while
the method is executing, making it possible to propagate it at will.</li>
  <li><strong>@Segment</strong>: when a method is marked with this annotation a new <a href="/core/tracing/core-concepts/#trace-segments">Segment</a> will be created only if there is a current
<code>TraceContext</code> while the annotated method is called.</li>
</ul>

<p>Let’s see these two annotations in action:</p>

<div class="code-example"><ul class="nav nav-tabs language-tab justify-content-end" role="tablist"><li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#scala_0_363272" role="tab">Scala</a></li><li class="nav-item"><a class="nav-link" data-toggle="tab" href="#java_1_363272" role="tab">Java</a></li></ul><div class="tab-content"><div class="tab-pane active" id="scala_0_363272" role="tabpanel"><pre class="line-numbers language-scala"><code class="language-scala">@EnableKamon
@Controller
@RequestMapping(value = Array(&quot;/scala/users&quot;))
class ScalaUsersController {

  val usersService = new ScalaUsersService

  @Trace(&quot;ListAllUsers&quot;)
  @RequestMapping(method = Array(RequestMethod.GET))
  @ResponseBody
  def listUsers: String =
    usersService.findUsers

}
</code></pre></div><div class="tab-pane" id="java_1_363272" role="tabpanel"><pre class="line-numbers language-java"><code class="language-java">@EnableKamon
@Controller
@RequestMapping(&quot;/java/orders&quot;)
public class JavaUsersController {

    private final JavaUsersService usersService = new JavaUsersService();

    @Trace(&quot;ListAllUsers&quot;)
    @RequestMapping(method = RequestMethod.GET)
    public @ResponseBody String listUsers() {
        return usersService.findUsers();
    }
}
</code></pre></div></div></div>

<p>In the example above we are annotating the <code>listUsers</code> method with <code>@Trace</code>, so Kamon will automatically start a new
trace named <code>ListAllUsers</code> every time this method is called and finish it once the method returns.</p>

<p>Furthermore, the typical use case for creating segments would be to delimitate pieces of functionality that contribute
to servicing a request in your application. In the example bellow we are using the <code>@Segment</code> annotation to
automatically create a segment every time the <code>findUsers</code> method is called in the correspondent users service. Since the
<code>@Trace</code> annotation in the controller methods is starting a new trace automatically, it is guaranteed that there will be
a current <code>TraceContext</code> when the service method is called, and the newly created segment will be scoped to that trace.</p>

<div class="code-example"><ul class="nav nav-tabs language-tab justify-content-end" role="tablist"><li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#scala_0_168628" role="tab">Scala</a></li><li class="nav-item"><a class="nav-link" data-toggle="tab" href="#java_1_168628" role="tab">Java</a></li></ul><div class="tab-content"><div class="tab-pane active" id="scala_0_168628" role="tabpanel"><pre class="line-numbers language-scala"><code class="language-scala">@EnableKamon
class ScalaUsersService {

  @Segment(name = &quot;FindUsers&quot;, category = &quot;database&quot;, library = &quot;kamon&quot;)
  def findUsers: String = {
    &quot;Some list of users.&quot;
  }
}
</code></pre></div><div class="tab-pane" id="java_1_168628" role="tabpanel"><pre class="line-numbers language-java"><code class="language-java">@EnableKamon
public class JavaUsersService {

    @Segment(name = &quot;FindUsers&quot;, category = &quot;database&quot;, library = &quot;kamon&quot;)
    String findUsers() {
        return &quot;Some list of users.&quot;;
    }
}
</code></pre></div></div></div>

<h2 id="manipulating-instruments">Manipulating Instruments</h2>

<p>Additionally to manipulating traces and segments, the <code>kamon-annotation</code> module provides annotations that can be used
to create Counters, Histograms and MinMaxCounters that are automatically updated as the annotated methods execute. These
annotations are:</p>

<ul>
  <li>
    <p><strong>@Time</strong>: when a method is marked with this annotation Kamon will create a Histogram tracking the latency of each
invocation to the method. Please keep in mind that in most situations you might want to use <code>@Segment</code> if you are tracking
some functionality that is executed within a trace.</p>
  </li>
  <li>
    <p><strong>@Histogram</strong>: when a method is marked with this annotation Kamon will create a Histogram that stores the values
returned every time the method is invoked. Obviously, only methods returning numeric values are accepted.</p>
  </li>
  <li>
    <p><strong>@Count</strong>: when a method is marked with this annotation Kamon will be create a Counter and automatically increment it
every time the method is invoked.</p>
  </li>
  <li>
    <p><strong>@MinMaxCount</strong>: when a method is marked with this annotation Kamon will be create a MinMaxCounter and automatically
increment it every time method is invoked and decremented when the method returns.</p>
  </li>
</ul>

<h3 id="el-expression-support">EL Expression Support</h3>

<p>The <code>name</code> and <code>tags</code> properties are evaluated as <a href="https://jcp.org/en/jsr/detail?id=341">EL</a> expressions for all annotations that manipulate instruments. This allows to
conveniently customize names and tags using the annotated class’s members as shown bellow:</p>

<div class="code-example"><ul class="nav nav-tabs language-tab justify-content-end" role="tablist"><li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#scala_0_564167" role="tab">Scala</a></li><li class="nav-item"><a class="nav-link" data-toggle="tab" href="#java_1_564167" role="tab">Java</a></li></ul><div class="tab-content"><div class="tab-pane active" id="scala_0_564167" role="tabpanel"><pre class="line-numbers language-scala"><code class="language-scala">import kamon.annotation.EnableKamon
import kamon.annotation.Count

@EnableKamon
case class Annotated(id: Long) {

  @Count(name = &quot;${&#39;count:&#39; += this.id}&quot;, tags = &quot;#{&#39;my-awesome-counter&#39;:&#39;1&#39;, &#39;env&#39;:&#39;prod&#39;}&quot;)
  def countedMethod(): Unit = {}

}
</code></pre></div><div class="tab-pane" id="java_1_564167" role="tabpanel"><pre class="line-numbers language-java"><code class="language-java">import kamon.annotation.EnableKamon;
import kamon.annotation.Count;

@EnableKamon
public class Annotated {

	private final Long id;

	public Annotated(Long id) {
		this.id = id;
	}

 	@Count(name = &quot;${&#39;count:&#39; += this.id}&quot;, tags = &quot;#{&#39;my-awesome-counter&#39;:&#39;1&#39;, &#39;env&#39;:&#39;prod&#39;}&quot;)
  	public void countedMethod() {}
	
}	
</code></pre></div></div></div>

<p>In the above example, Kamon will create a Counter instrument with the name obtained from evaluating the expresion
<code>${'count:' += this.id}</code> at the moment of instantiation of the <code>Annotated</code> class. Please keep in mind that the provided
expressions are evaluated <strong>only once</strong> when the annotated class is instantiated. If the value of the <code>id</code> attribute in
the example above changes over time it won’t affect the registered counter.</p>

<h2 id="limitations">Limitations</h2>

<p>Annotations are not inherited, regardless of them being declared on a parent class or an implemented interface method.
The root causes of that limitation, according to the <a href="http://docs.oracle.com/javase/specs/jls/se7/html/jls-9.html#jls-9.6">JLS</a>, are:</p>

<ul>
  <li>Non-type annotations are not inherited,</li>
  <li>Annotations on types are only inherited if they have the <strong>@Inherited</strong> meta-annotation,</li>
  <li>Annotations on interfaces are not inherited irrespective to having the <strong>@Inherited</strong> meta-annotation.</li>
</ul>


            </div>
          </div>
          <!--<div class="row align-items-center kamino-docs-bottom">
            <div class="col-xs-offset-1 col-xs-5">
                <a href="http://kamino.io">
                  <img class="img-fluid" alt="Sponsored by Kamino" src="/assets/img/sponsored-by-kamino.svg">
                </a>
                <a class="btn btn-sign-up btn-lg">Visit kamino.io</a>
            </div>
          </div>-->
        </div>

        <div class="col-12 col-md-3 pull-md-9 documentation-sidebar">
          <section>
  <ul class="tree">
    <li><a class="docs-level-three side" href="/documentation/get-started/"></i>Get Started</a></li>
    <li><a class="docs-level-three side" href="/documentation/events-and-workshops/"></i>Upcoming Events</a></li>
  </ul>
</section>
          


<section>
  <div class="tree tree-toggler docs-level-one row justify-content-between align-items-center">
    <span>
      kamon-annotation
    </span>

    <div class="dropdown version-dropdown">
      <a class="btn btn-secondary dropdown-toggle" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        0.6.6
      </a>

      <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
        
          <a class="dropdown-item" href="/documentation/kamon-annotation/0.6.6/overview/">0.6.6</a>
        
      </div>
    </div>
  </div>

  <ul>
    
      <li><a class="docs-level-three" href="/documentation/kamon-annotation/0.6.6/overview/">Using Annotations</a></li>
    

    
</section>
          <section>
  <div class="tree tree-toggler docs-level-one row align-items-center">
    <span>All Modules</span>
  </div>
  <ul class="tree tree-toggler">
    <li>
      <label class="tree-toggler tree docs-level-two">Foundations</label>
      <ul>
        <li><a class="docs-level-three" href="/documentation/kamon-core/0.6.6/overview/">Metrics and Tracing</a></li>
      </ul>
    </li>

    <li>
      <label class="tree-toggler tree docs-level-two">Metrics Collection</label>
      <ul>
        <li><a class="docs-level-three" href="/documentation/kamon-akka/0.6.6/overview/">Akka</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-scala/0.6.6/overview/">Scala Futures</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-play/0.6.6/overview/">Play Framework</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-spray/0.6.6/overview/">Spray</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-jdbc/0.6.6/overview/">JDBC</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-annotation/0.6.6/overview/">Annotations</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-system-metrics/0.6.6/overview/">System Metrics</a></li>
      </ul>
    </li>

    <li>
      <label class="tree-toggler tree docs-level-two">Reporter Backends</label>
      <ul>
        <!--<li><a class="docs-level-three" href="/documentation/kamon-kamino/0.6.6/overview/">Kamino</a></li>-->
        <li><a class="docs-level-three" href="/documentation/kamon-statsd/0.6.6/overview/">StatsD</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-datadog/0.6.6/overview/">Datadog</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-newrelic/0.6.6/overview/">New Relic</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-sematext-spm/0.6.6/overview/">Sematext SPM</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-jmx/0.6.6/overview/">JMX</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-fluentd/0.6.6/overview/">FluentD</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-influxdb/0.6.6/overview/">InfluxDB</a></li>
        <!--<li><a class="docs-level-three" href="/documentation/kamon-graphite/1.0.4/overview/">Graphite</a></li>-->
        <li><a class="docs-level-three" href="/documentation/kamon-riemann/0.6.6/overview/">Riemann</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-khronus/0.6.6/overview/">Khronus</a></li>

      </ul>
    </li>    
  </ul>
</section>
        </div>

      </div>
    </div>

    <div class="hero jumbotron-bottom">
  <div class="container">
    <div class="row middle-xs">
      <div class="col-xs-12">
        
      </div>
    </div>
  </div>
</div>


<!--<footer class="footer">
  <div class="container">
    <div class="row">
      <div class="col-sm-8 col-sm-offset-2">
        <p class="text-center upper">
          Get in touch
        </p>
        <p class="text-center">
          <a href="https://twitter.com/kamonteam" class="social-icon"><i class="fa fa-twitter"></i></a>
          <a href="https://github.com/kamon-io/Kamon" class="social-icon"><i class="fa fa-2x fa-github"></i></a>
          <a href="/teamblog/rss/" class="social-icon"><i class="fa fa-rss"></i></a>
          <a href="https://groups.google.com/forum/#!forum/kamon-user" class="social-icon"><i class="fa fa-envelope"></i></a>
        </p>
        <p class="text-center">
          <a href="/introduction/project-info/support/" class="btn btn-support upper">Support <i class="fa fa-wrench"></i></a>
        </p>
        <p class="text-center">
          <img src="/assets/img/kamon-footer-logo.png" alt="logo" />
        </p>
        <p class="copyright">
          &copy; 2015 Kamon. All rights reserved.
        </p>
      </div>
    </div>
  </div>
</footer>-->



    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="/assets/js/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/assets/js/tether.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/assets/js/prism.js"></script>
    <script src="/assets/js/prism-typesafeconfig.js"></script>
    <script>

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-45369085-1', 'kamon.io');
    ga('send', 'pageview');

</script>

  </body>
</html>
