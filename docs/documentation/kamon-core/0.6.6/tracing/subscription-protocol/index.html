<html lang="en">
  <head>
    <title>Kamon | Core | Documentation</title>

<meta charset="utf-8">
<meta name="viewport"    content="width=device-width, initial-scale=1.0">
<meta name="description" content="Kamon is a set of tools that will help you monitor your reactive applications">

<!--<link rel="stylesheet" href="/assets/css/syntax-highlight.css">-->
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="/assets/css/prism.css">
<link rel="stylesheet" href="/assets/css/styles.css">
<link rel="stylesheet" href="/assets/css/kamon.css">


<link rel="shortcut icon" href="/assets/img/favicon.ico" type="image/x-icon">
<link rel="icon" href="/assets/img/favicon.ico" type="image/x-icon">
<link href="https://plus.google.com/107736741680270898032?rel=author">
<link rel="alternate" type="application/rss+xml" title="Kamon Teamblog Feed" href="/teamblog/rss/">

<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

  </head>
  <body>
    <nav class="navbar navbar-default kamon-navbar">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-12 col-md-3">
          <a href="/documentation/get-started/">
            <img class="kamon-logo-image" alt="Kamon" src="/assets/img/kamon-logo-latest.svg">
          </a>
      </div>

      <div class="col-12 col-md-9">
        <div class="row justify-content-end align-items-center navigation-links">
            <div class="wip-warning col-12 col-md-4">
              WARNING: We are updating and fixing all docs around!
            </div>
            <a class="col-12 col-md-4 col-lg-3" href="/documentation/get-started/">
              <span class="nav-link">DOCUMENTATION</span>
            </a>
            <a class="col-12 col-md-2" href="/teamblog/">
              <span class="nav-link">BLOG</span>
            </a>
            
            <div class="col-12 col-md-2 hidden-sm-down">
              <div class="row justify-content-around align-items-center">
                <a href="https://twitter.com/kamonteam">
                  <i class="fa fa-twitter fa-lg nav-icon" aria-hidden="true"></i>
                </a>
                <a href="https://github.com/kamon-io/Kamon">
                  <i class="fa fa-github fa-lg nav-icon" aria-hidden="true"></i>
                </a>
                <a href="http://kamon.io/teamblog/rss/">
                  <i class="fa fa-rss fa-lg nav-icon" aria-hidden="true"></i>
                </a>
                <a href="https://groups.google.com/forum/#!forum/kamon-user">
                  <i class="fa fa-envelope fa-lg nav-icon" aria-hidden="true"></i>
                </a>
              </div>
            </div>
        </div>
      </div>
    </div>
  </div>
</nav>
      <div class="hero jumbotron-top">
    <div class="container">
      <div class="row">
        <div class="col-xs-12 col-md-7">
          <span class="jumbo-title">Documentation</span>
        </div>
      </div>
    </div>
  </div>  

    <div class="container">
      <div class="row">
        <div class="col-12 col-md-9 push-md-3">
          <div class="row align-items-center justify-content-end kamino-docs-top">
            <div>
                <a href="https://kamino.io">
                  <img class="img-fluid" alt="Sponsored by Kamino" src="/assets/img/sponsored-by-kamino.svg">
                </a>
            </div>
          </div>
          <div class="row docs-content">
            <div class="col-12">
              <h1 id="traces-subscription-protocol">Traces Subscription Protocol</h1>

<p>When you configure your application to use the “Simple Tracing” level, you can subscribe with the tracing module to
receive <code>TraceInfo</code> messages every time a trace is selected to be reported. To subscribe, simply use the
<code>Kamon.tracer.subscribe(...)</code> method as shown in the example bellow:</p>

<div class="code-example"><ul class="nav nav-tabs language-tab justify-content-end" role="tablist"><li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#scala_0_631962" role="tab">Scala</a></li><li class="nav-item"><a class="nav-link" data-toggle="tab" href="#java_1_631962" role="tab">Java</a></li></ul><div class="tab-content"><div class="tab-pane active" id="scala_0_631962" role="tabpanel"><pre class="line-numbers language-scala"><code class="language-scala">  Kamon.tracer.subscribe(subscriber)
</code></pre></div><div class="tab-pane" id="java_1_631962" role="tabpanel"><pre class="line-numbers language-java"><code class="language-java">    Kamon.tracer().subscribe(subscriber);
</code></pre></div></div></div>

<p>As simple as that. Once you do this, your subscriber will be receiving <code>TraceInfo</code> messages every time a trace is
sampled.</p>

<p class="alert alert-warning">
Please note that the simple traces subscriptions are very likely to change in future Kamon versions since we plan to
enhance it's capabilities to allow for more detailed tracing as well as distributed tracing.
</p>

<h2 id="creating-a-simple-subscriber">Creating a Simple Subscriber</h2>

<p>The <code>TraceInfo</code> messages have a very simple structure, they have the basic attributes you would expect from a
<code>TraceContext</code>: name, token, timestamp, elapsed time and a collection of <code>SegmentInfo</code> objects, which have their own
name, category, library, timestamp and elapsed time attributes. With that in mind, let’s first create a trace with
some segments on it and then a simple reporter that just dumps this information in the console.</p>

<div class="code-example"><ul class="nav nav-tabs language-tab justify-content-end" role="tablist"><li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#scala_0_427223" role="tab">Scala</a></li><li class="nav-item"><a class="nav-link" data-toggle="tab" href="#java_1_427223" role="tab">Java</a></li></ul><div class="tab-content"><div class="tab-pane active" id="scala_0_427223" role="tabpanel"><pre class="line-numbers language-scala"><code class="language-scala">  Tracer.withNewContext(&quot;example-trace&quot;, autoFinish = true) {
    Tracer.currentContext.withNewSegment(&quot;quick-segment&quot;, &quot;code&quot;, &quot;kamon&quot;) {
      Thread.sleep(100)
    }

    Tracer.currentContext.withNewSegment(&quot;slow-segment&quot;, &quot;code&quot;, &quot;kamon&quot;) {
      Thread.sleep(3000)
    }
  }
</code></pre></div><div class="tab-pane" id="java_1_427223" role="tabpanel"><pre class="line-numbers language-java"><code class="language-java">    Tracer.withNewContext(&quot;trace-with-segments&quot;, true, () -&gt; {
      Tracer.currentContext().withNewSegment(&quot;quick-segment&quot;, &quot;code&quot;, &quot;kamon&quot;, () -&gt; {
        try{ Thread.sleep(100); } catch (Exception e) { e.printStackTrace(); }
        return 0;
      });

      Tracer.currentContext().withNewSegment(&quot;slow-segment&quot;, &quot;code&quot;, &quot;kamon&quot;, () -&gt; {
        try{ Thread.sleep(3000); } catch (Exception e) { e.printStackTrace(); }
        return 0;
      });

      return &quot;done&quot;;
    });
</code></pre></div></div></div>

<p>The code above is simply creating a trace and then creating a couple segments that will have different durations; the
first segment is named “quick-segment” and should have a elapsed time of around 100 milliseconds and the second segment
is named “slow-segment” and should have a elapsed time of around 3 seconds.</p>

<p>Bellow we have the code for a subscriber actor that would just wait for <code>TraceInfo</code> messages and print them in the console
with some formatting.</p>

<div class="code-example"><ul class="nav nav-tabs language-tab justify-content-end" role="tablist"><li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#scala_0_950638" role="tab">Scala</a></li><li class="nav-item"><a class="nav-link" data-toggle="tab" href="#java_1_950638" role="tab">Java</a></li></ul><div class="tab-content"><div class="tab-pane active" id="scala_0_950638" role="tabpanel"><pre class="line-numbers language-scala"><code class="language-scala">class TracePrinter extends Actor {
  def receive = {
    case traceInfo: TraceInfo =&gt;

    println(&quot;#################################################&quot;);
    println(&quot;Trace Name: &quot; + traceInfo.name)
    println(&quot;Timestamp: &quot; + traceInfo.timestamp)
    println(&quot;Elapsed Time: &quot; + traceInfo.elapsedTime)
    println(&quot;Segments: &quot;);

    traceInfo.segments.foreach { segmentInfo =&gt;
      println(&quot;    ------------------------------------------&quot;);
      println(&quot;    Name: &quot; + segmentInfo.name)
      println(&quot;    Category: &quot; + segmentInfo.category)
      println(&quot;    Library: &quot; + segmentInfo.library)
      println(&quot;    Timestamp: &quot; + segmentInfo.timestamp)
      println(&quot;    Elapsed Time: &quot; + segmentInfo.elapsedTime)
    }
  }
}
</code></pre></div><div class="tab-pane" id="java_1_950638" role="tabpanel"><pre class="line-numbers language-java"><code class="language-java">  public static class TracePrinter extends UntypedActor {

    @Override
    public void onReceive(Object message) throws Exception {
      if(message instanceof TraceInfo) {
        final TraceInfo traceInfo = (TraceInfo) message;
        final List&lt;SegmentInfo&gt; segments = seqAsJavaList(traceInfo.segments());

        System.out.println(&quot;#################################################&quot;);
        System.out.println(&quot;Trace Name: &quot; + traceInfo.name());
        System.out.println(&quot;Timestamp: &quot; + traceInfo.timestamp());
        System.out.println(&quot;Elapsed Time: &quot; + traceInfo.elapsedTime());
        System.out.println(&quot;Segments: &quot;);

        segments.forEach(segmentInfo -&gt; {
          System.out.println(&quot;    ------------------------------------------&quot;);
          System.out.println(&quot;    Name: &quot; + segmentInfo.name());
          System.out.println(&quot;    Category: &quot; + segmentInfo.category());
          System.out.println(&quot;    Library: &quot; + segmentInfo.library());
          System.out.println(&quot;    Timestamp: &quot; + segmentInfo.timestamp());
          System.out.println(&quot;    Elapsed Time: &quot; + segmentInfo.elapsedTime());
        });

      } else unhandled(message);
    }
  }
</code></pre></div></div></div>

<p>Once the trace is finished and reported, the generated output looks like this:</p>

<div class="code-example"><ul class="nav nav-tabs language-tab justify-content-end" role="tablist"><li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#scala_0_849811" role="tab">Example Output</a></li></ul><div class="tab-content"><div class="tab-pane active" id="scala_0_849811" role="tabpanel"><pre class="line-numbers language-scala"><code class="language-scala">#################################################
Trace Name: example-trace
Timestamp: 1429311913406000000.nanos
Elapsed Time: 3103544112.nanos
Segments:
    ------------------------------------------
    Name: quick-segment
    Category: code
    Library: kamon
    Timestamp: 1429311913408589398.nanos
    Elapsed Time: 100184837.nanos
    ------------------------------------------
    Name: slow-segment
    Category: code
    Library: kamon
    Timestamp: 1429311913509367747.nanos
    Elapsed Time: 3000135844.nanos
</code></pre></div></div></div>

            </div>
          </div>
          <!--<div class="row align-items-center kamino-docs-bottom">
            <div class="col-xs-offset-1 col-xs-5">
                <a href="http://kamino.io">
                  <img class="img-fluid" alt="Sponsored by Kamino" src="/assets/img/sponsored-by-kamino.svg">
                </a>
                <a class="btn btn-sign-up btn-lg">Visit kamino.io</a>
            </div>
          </div>-->
        </div>

        <div class="col-12 col-md-3 pull-md-9 documentation-sidebar">
          <section>
  <ul class="tree">
    <li><a class="docs-level-three side" href="/documentation/get-started/"></i>Get Started</a></li>
    <li><a class="docs-level-three side" href="/documentation/events-and-workshops/"></i>Upcoming Events</a></li>
  </ul>
</section>
          


<section>
  <div class="tree tree-toggler docs-level-one row justify-content-between align-items-center">
    <span>
      kamon-core
    </span>

    <div class="dropdown version-dropdown">
      <a class="btn btn-secondary dropdown-toggle" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        0.6.6
      </a>

      <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
        
          <a class="dropdown-item" href="/documentation/kamon-core/0.6.6/overview/">0.6.6</a>
        
      </div>
    </div>
  </div>

  <ul>
    
      <li><a class="docs-level-three" href="/documentation/kamon-core/0.6.6/overview/">Get Started</a></li>
    
      <li><a class="docs-level-three" href="/documentation/kamon-core/0.6.6/configuration/">Configuring Kamon</a></li>
    

    
      <li>
      <label class="tree-toggler tree docs-level-two">Tracing</label>
      <ul class="tree tree-toggler">
        
        
          <li><a class="docs-level-three" href="/documentation/kamon-core/0.6.6/tracing/core-concepts/">Core Concepts</a></li>
        
          <li><a class="docs-level-three" href="/documentation/kamon-core/0.6.6/tracing/subscription-protocol/">Subscription Protocol</a></li>
        
          <li><a class="docs-level-three" href="/documentation/kamon-core/0.6.6/tracing/threading-model-considerations/">Threading Model Considerations</a></li>
        
          <li><a class="docs-level-three" href="/documentation/kamon-core/0.6.6/tracing/trace-context-manipulation/">Trace Context Manipulation</a></li>
        
          <li><a class="docs-level-three" href="/documentation/kamon-core/0.6.6/tracing/trace-metrics/">Trace Metrics</a></li>
        
      </ul>
      </li>
    
      <li>
      <label class="tree-toggler tree docs-level-two">Metrics</label>
      <ul class="tree tree-toggler">
        
        
          <li><a class="docs-level-three" href="/documentation/kamon-core/0.6.6/metrics/core-concepts/">Core Concepts</a></li>
        
          <li><a class="docs-level-three" href="/documentation/kamon-core/0.6.6/metrics/instruments/">Instruments</a></li>
        
          <li><a class="docs-level-three" href="/documentation/kamon-core/0.6.6/metrics/recording-metrics/">Recording Metrics</a></li>
        
          <li><a class="docs-level-three" href="/documentation/kamon-core/0.6.6/metrics/subscription-protocol/">Subscription Protocol</a></li>
        
      </ul>
      </li>
    
      <li>
      <label class="tree-toggler tree docs-level-two">Modules</label>
      <ul class="tree tree-toggler">
        
        
          <li><a class="docs-level-three" href="/documentation/kamon-core/0.6.6/modules/using-modules/">Using Modules</a></li>
        
      </ul>
      </li>
    
</section>
          <section>
  <div class="tree tree-toggler docs-level-one row align-items-center">
    <span>All Modules</span>
  </div>
  <ul class="tree tree-toggler">
    <li>
      <label class="tree-toggler tree docs-level-two">Foundations</label>
      <ul>
        <li><a class="docs-level-three" href="/documentation/kamon-core/0.6.6/overview/">Metrics and Tracing</a></li>
      </ul>
    </li>

    <li>
      <label class="tree-toggler tree docs-level-two">Metrics Collection</label>
      <ul>
        <li><a class="docs-level-three" href="/documentation/kamon-akka/0.6.6/overview/">Akka</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-scala/0.6.6/overview/">Scala Futures</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-play/0.6.6/overview/">Play Framework</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-spray/0.6.6/overview/">Spray</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-jdbc/0.6.6/overview/">JDBC</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-annotation/0.6.6/overview/">Annotations</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-system-metrics/0.6.6/overview/">System Metrics</a></li>
      </ul>
    </li>

    <li>
      <label class="tree-toggler tree docs-level-two">Reporter Backends</label>
      <ul>
        <!--<li><a class="docs-level-three" href="/documentation/kamon-kamino/0.6.6/overview/">Kamino</a></li>-->
        <li><a class="docs-level-three" href="/documentation/kamon-statsd/0.6.6/overview/">StatsD</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-datadog/0.6.6/overview/">Datadog</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-newrelic/0.6.6/overview/">New Relic</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-sematext-spm/0.6.6/overview/">Sematext SPM</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-jmx/0.6.6/overview/">JMX</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-fluentd/0.6.6/overview/">FluentD</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-influxdb/0.6.6/overview/">InfluxDB</a></li>
        <!--<li><a class="docs-level-three" href="/documentation/kamon-graphite/1.0.4/overview/">Graphite</a></li>-->
        <li><a class="docs-level-three" href="/documentation/kamon-riemann/0.6.6/overview/">Riemann</a></li>
        <li><a class="docs-level-three" href="/documentation/kamon-khronus/0.6.6/overview/">Khronus</a></li>

      </ul>
    </li>    
  </ul>
</section>
        </div>

      </div>
    </div>

    <div class="hero jumbotron-bottom">
  <div class="container">
    <div class="row middle-xs">
      <div class="col-xs-12">
        
      </div>
    </div>
  </div>
</div>


<!--<footer class="footer">
  <div class="container">
    <div class="row">
      <div class="col-sm-8 col-sm-offset-2">
        <p class="text-center upper">
          Get in touch
        </p>
        <p class="text-center">
          <a href="https://twitter.com/kamonteam" class="social-icon"><i class="fa fa-twitter"></i></a>
          <a href="https://github.com/kamon-io/Kamon" class="social-icon"><i class="fa fa-2x fa-github"></i></a>
          <a href="/teamblog/rss/" class="social-icon"><i class="fa fa-rss"></i></a>
          <a href="https://groups.google.com/forum/#!forum/kamon-user" class="social-icon"><i class="fa fa-envelope"></i></a>
        </p>
        <p class="text-center">
          <a href="/introduction/project-info/support/" class="btn btn-support upper">Support <i class="fa fa-wrench"></i></a>
        </p>
        <p class="text-center">
          <img src="/assets/img/kamon-footer-logo.png" alt="logo" />
        </p>
        <p class="copyright">
          &copy; 2015 Kamon. All rights reserved.
        </p>
      </div>
    </div>
  </div>
</footer>-->



    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="/assets/js/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/assets/js/tether.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/assets/js/prism.js"></script>
    <script src="/assets/js/prism-typesafeconfig.js"></script>
    <script>

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-45369085-1', 'kamon.io');
    ga('send', 'pageview');

</script>

  </body>
</html>
