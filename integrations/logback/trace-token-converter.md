---
title: Kamon | Core | Documentation
layout: documentation
---

Logback Trace Token Converter
=============================

Our Logback integration is extremely simple as it just provides a single converter that allows you to include the
current trace token in your log patterns. The entire implementation looks like this:

{% code_example %}
{%   language scala kamon-core-examples/src/main/scala/kamon/examples/scala/TraceTokenLogging.scala tag:converter-definition %}
{% endcode_example %}

That doesn't sound like a big deal, but there are many benefits that can be derived from logging the trace token from
the currently available `TraceContext` in your application, let's explore that idea with a simple example: suppose you
have a process that involves a couple actors and you want to make sense of the logs generated by that process. The
actors might look like this:

{% code_example %}
{%   language scala kamon-core-examples/src/main/scala/kamon/examples/scala/TraceTokenLogging.scala tag:trace-token-logging %}
{%   language java kamon-core-examples/src/main/java/kamon/examples/java/TraceTokenLogging.java tag:trace-token-logging %}
{% endcode_example %}

If we spawn a `UpperCaser` actor and send it five string messages the log should contain something like this:

{% code_example %}
{%   language text kamon-core-examples/src/main/scala/kamon/examples/scala/TraceTokenLogging.scala tag:trace-token-logging-output-without-token label:"Log Output" %}
{% endcode_example %}

Can you tell which log statement from the `LengthCalculator` actor corresponds to each log statement from `UpperCaser`
actor?, seems easy to figure it out manually in this case, but as the number of events happening concurrently in your
application grows it becomes harder to answer that question without some extra help. Let's see how Kamon can help us in
this situation:

{% code_example %}
{%   language scala kamon-core-examples/src/main/scala/kamon/examples/scala/TraceTokenLogging.scala tag:sending-async-events %}
{%   language java kamon-core-examples/src/main/java/kamon/examples/java/TraceTokenLogging.java tag:sending-async-events %}
{% endcode_example %}

When using the `TraceRecorder.withNewContext(..)` method, Kamon will create a new `TraceContext` and make it available
during the execution of the piece of code passed as argument. This time, we are sending a message to an actor which
happens to be one of the situations under which Kamon will automatically propagate a `TraceContext` if you have the
`kamon-akka` module in place, so we can expect the current context to be available to the actor when processing the
message we just sent, and <strong>only</strong> when processing that message. Let's repeat the exercise of sending five
messages to this actor, now doing it with a new `TraceContext` each time and look at the log:


{% code_example %}
{%   language text kamon-core-examples/src/main/scala/kamon/examples/scala/TraceTokenLogging.scala tag:trace-token-logging-output-with-token label:"Log Output" %}
{% endcode_example %}


Can you tell which log statement from `LengthCalculator` corresponds to each log statement from `UpperCaser` now?, it
has become a no-brainer: each `TraceContext` created by Kamon gets a unique trace token that we are including in the log
patterns (the first value between square brackets) and with that small but important piece of information the relation
between each log line is absolutely clear.


Including the Trace Token in your Application Logs
--------------------------------------------------

Kamon has built in support for logging the trace token via the `kamon.trace.logging.LogbackTraceTokenConverter`
converter for Logback, which is included in the `kamon-core` artifact but as you saw at the beginning of this section,
it's implementation is rather simple and you could easily port it to the equivalent in other logging toolkits.

To log the trace token with Logback, simply add the converter to your `logback.xml` configuration file and use it in
your logging patterns as show bellow:

{% code_example %}
{%   language markup kamon-core-examples/src/main/resources/logback.xml tag:logback-config label:"logback.xml" %}
{% endcode_example %}
